function c(e){window.enmity.plugins.registerPlugin(e)}const r={byProps:(...e)=>window.enmity.modules.filters.byProps(...e),byName:e=>window.enmity.modules.filters.byName(e),byTypeName:e=>window.enmity.modules.filters.byTypeName(e),byTypeString:(...e)=>window.enmity.modules.filters.byTypeString(...e),byDefaultString:(...e)=>window.enmity.modules.filters.byDefaultString(...e),byString:(...e)=>window.enmity.modules.filters.byString(...e)};function y(...e){return window.enmity.modules.bulk(...e)}function u(e){return window.enmity.patcher.create(e)}async function w(){return new Promise((e,t)=>{window.enmity.users.fetchCurrentUser().then(s=>{e(s)}).catch(t)})}const o=u("freemoji"),{messages:p}=window.enmity.modules.common,[a,f,b,{getChannel:h}]=y(r.byProps("canUseEmojisEverywhere","canUseAnimatedEmojis"),r.byProps("openEmojiPickerActionSheet"),r.byProps("openLazy","hideActionSheet"),r.byProps("getChannel")),g={name:"Freemoji",onStart(){w().then(({premiumType:e})=>{if(!e){let t=!0;o.instead(a,"canUseEmojisEverywhere",()=>t),o.instead(a,"canUseAnimatedEmojis",()=>t),o.before(p,"sendMessage",(s,[m,i])=>{const l=h(m);i.validNonShortcutEmojis.forEach((n,d)=>{(n.guildId!==l.guild_id||n.animated)&&(i.content=i.content.replace(`<${n.animated?"a":""}:${n.name}:${n.id}>`,n.url.replace("webp","png").replace(/size=\d+/,"size=48")),delete i.validNonShortcutEmojis[d])}),i.validNonShortcutEmojis=i.validNonShortcutEmojis.filter(n=>n)}),o.before(f,"openEmojiPickerActionSheet",(s,[m])=>{t=m.pickerIntention!==0}),o.after(b,"hideActionSheet",()=>{t=!0})}})},onStop(){o.unpatchAll()}};c(g);
